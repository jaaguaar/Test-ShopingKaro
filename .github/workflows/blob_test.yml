name: ST_Mount

on:
  workflow_dispatch:

jobs:
  build:
    name: Build and analyze
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      - name: install blobfuse
        run: |
          sudo apt-get install blobfuse2
          # cd ${{ runner.temp }}
          # sudo wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
          # sudo dpkg -i packages-microsoft-prod.deb
          # sudo apt-get update
          # sudo apt-get install libfuse3-dev fuse3
      - name: Create NVD folder
        run: |
          sudo mkdir /mnt/nvd_data
          sudo mkdir ${{ runner.temp }}/blobfusetmp
      - name: mount blob
        env:
          AZURE_STORAGE_AUTH_TYPE: Key
          AZURE_STORAGE_ACCOUNT: ${{ secrets.STORAGE_ACCOUNT_NAME }}
          AZURE_STORAGE_ACCESS_KEY: ${{ secrets.STORAGE_ACCOUNT_KEY }}
          AZURE_STORAGE_ACCOUNT_CONTAINER: ${{ secrets.CONTAINER_NAME }}
        run: |
          sudo blobfuse2 mount /mnt/nvd_data --tmp-path=${{ runner.temp }}/blobfusetmp
          cd /mnt/nvd_data
          ls -a
